language: cpp

os:
  - windows
  #- linux

compiler:
  - clang++

branches:
  only:
    - master
    - integration

before_install:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt -q update; fi
  #- if [ "$TRAVIS_OS_NAME" = "windows" ]; then choco upgrade all; fi

install:
  # install packages on linux
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt -y install clang-8; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt -y install python3; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo pip install conan; fi
  # install packages on windows
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then choco install python; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then python -m pip || wget https://bootstrap.pypa.io/get-pip.py | python get-pip.py; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then pip install --upgrade pip; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then pip install conan; fi

after_success:
  - wget https://raw.githubusercontent.com/DiscordHooks/travis-ci-discord-webhook/master/send.sh
  - chmod +x ./send.sh
  - ./send.sh success $WEBHOOK_URL
after_failure:
  - wget https://raw.githubusercontent.com/DiscordHooks/travis-ci-discord-webhook/master/send.sh
  - chmod +x ./send.sh
  - ./send.sh failure $WEBHOOK_URL

script:
  - mkdir build;
  - cd build;
  - conan remote add bincrafters https://api.bintray.com/conan/bincrafters/public-conan;
  - sudo update-alternatives --set c++ /usr/bin/clang++-8;
  - conan profile update settings.compiler=clang default;
  - conan profile update settings.compiler.version=8 default;
  - conan profile update settings.compiler.libcxx=libstdc++11 default;
  - conan install .. --build missing -s build_type=Debug;
  - cmake ..;
  - cmake --build . --config Debug --parallel